<!DOCTYPE html>
<html lang="en-US">
 <head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>
  <title>Searching the 'What is Chandra doing now?' site</title>
  <link href="/css/main.css" type="text/css" rel="stylesheet" title="Default"
        media="all">
  <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
  <link rel="stylesheet"
        href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <link href="/css/search.css" type="text/css" rel="stylesheet">
 </head>
 <body>
  <nav role="navigation">
   <ul>
    <li><a id='home'  href="/index.html">What is Chandra doing now?</a></li>
    <li><a id='sched' href="/schedule/index.html">Schedule</a></li>
    <li><a id='expl'  class='chosen' href="/search/index.html">Explore</a></li>
    <li><a id='about' href="/about/index.html">About</a></li>
    <li><a id='insts' href="/about/instruments.html">Instruments</a></li>
    <li><a id='views' href="/about/views.html">Views</a></li>
   </ul>
  </nav>

  <div class="explanation">
    Here are some ways to explore the observations
    performed by Chandra:
  </div>

  <ul>
    <li><a href="/search/instrument/">by instrument</a>,</li>
    <li>by viewing the
      <a href="/search/dtype">full SIMBAD object hierarchy</a>
      or 
      <a href="/search/type">treating them individually</a>,
    </li>
    <li><a href="/search/constellation/">by constellation</a>,</li>
    <li><a href="/search/category/">by proposal category</a>,</li>
    <li><a href="/search/calendar/">a calendar view</a>,</li>
    <li>and looking at <a href="/search/mappings/">how the proposal categories
      and SIMBAD object types are related</a>.</li>
  </ul>

  <div>
    <form action="/search/name" method="get">
      <label for="namesearch">
        You can also try searching by target name:
      </label>
      <input type="text" autocomplete="off" id="namesearch" name="target" />
    </form>
  </div>

  <div>
    <form action="/search/proposal" method="get">
      <label for="propnamesearch">
        How about searching proposals by name?
      </label>
      <input type="text" autocomplete="off" id="propnamesearch" name="target" />
    </form>
  </div>

  <p>
    The text search will match your input against the schedule, and provide
    suggestions, but this only happens after three or more characters
    are entered. The searches are case insensitive and
    exact, so you can not search for all
    observations of targets containing the string <tt>NGC</tt>.
    Note that there is an issue with spaces in the text searches; ideally the names
    would be normalized (or the search would be), but at present
    they are not, so <tt>NGC   404</tt>, <tt>NGC 404</tt>, and
    <tt>NGC404</tt> are different.
  </p>

  <script>
    // from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent
function fixedEncodeURIComponent(str) {
  return encodeURIComponent(str).replace(/[!'()*]/g, function(c) {
    return '%' + c.charCodeAt(0).toString(16);
  });
}

function selected(prefix) {
    return function(event, ui) {
    // skip if the event has been cancelled; for now only support
    // event=Enter, as not sure what the event types can be, but
    // this may need to be changed (e.g. touch screens).
    //
    if (event.key == "Enter") {
      var term = event.target.value;
      window.location = prefix + fixedEncodeURIComponent(term);
      }
    };
}
    
    $("#namesearch").autocomplete({
    minLength: 3,
    source: '/api/search/name',
    close: selected("/search/name?target=")
    });

    /* the UI is a bit confusing here since the text gets replaced by
       the number; there must be a better way */
    $("#propnamesearch").autocomplete({
    minLength: 3,
    source: function(request, response) {
    $.ajax({
          url: "/api/search/proposal",
          dataType: "json",
          data: {
            term: request.term
          },
          success: function(data) {
    response(data.map(function(d) {
      return { label: d.title, value: d.number };
    }));
          },
          error: function(data) {
            /* not sure what the expected behavior here is */
            response([]);
          },
        });
    },
    close: selected("/proposal/")
    });
</script>
  
  <p id="banner">
    The 'What is Chandra doing now?' web site is written
    by <a href="http://twitter.com/doug_burke">@doug_burke</a>,
    comes with no warranty (in other words, I make no
    guarantee that the information presented is correct, although
    I try my best to make sure it is), and is not
    an official product of the 
    <a href="http://chandra.si.edu/">Chandra X-ray Center</a>.
  </p>
 </body>
</html>
